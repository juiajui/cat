async function activatePush() {
    OneSignalDeferred.push(async function(OneSignal) {
        // 先確認 SDK 是否真的準備好了
        if (!OneSignal.Notifications) {
            alert("SDK 尚未載入完成，請稍等 3 秒再試一次。");
            return;
        }

        try {
            // 第一次點擊：彈出系統請求視窗
            await OneSignal.Notifications.requestPermission();
            
            // 等待 2 秒讓系統處理訂閱
            setTimeout(async () => {
                const userId = OneSignal.User.PushSubscription.id;
                if (userId) {
                    alert("✅ 啟用成功！\nID: " + userId);
                } else {
                    alert("❌ 仍未取得 ID。\n請檢查：\n1. 是否已加入主畫面\n2. 手機設定 > 通知 > Cat助手 是否已開啟");
                }
            }, 2000);
        } catch (e) {
            alert("發生錯誤: " + e);
        }
    });
}
